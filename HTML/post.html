<!DOCTYPE html>

<link rel="stylesheet" href="../CSS/postStyle.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <form id="postForm" method="post" enctype="multipart/form-data">
    
    <div class="PostHeader">
      <img id="header" src="../CSS/ArtAssets/Post/banner (post).png"/>
      <input type="file" 
            class="form-control-file" 
            id="img" 
            label="Upload image:" 
            name="img_upload" 
            accept=".jpg, .jpeg, .png" 
            style="display:none;"/>
            <label for="img">
              <img id="fileIcon" src="../CSS/ArtAssets/Post/add file.png"/>
            </label>

          <input id="close-modal" 
                 data-dismiss="modal" 
                 aria-label="Close" 
                 type="image"
                 src="../CSS/ArtAssets/Post/close.png"/>

    </div>
    
    <div class="form-group">
      <textarea class="form-control-text" 
                id="text" 
                name="text" 
                rows="10" cols="83"> </textarea>
      
      <input type="submit" value="SUBMIT" id="submitPost">
    </div>
  </form>

<script>  
  const form = document.getElementById("postForm");
  //upload listener
  form.addEventListener("submit",async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
  
    try{
      const response = await fetch("http://127.0.0.1:3000/", {
        method: "POST",
        //headers: { "Content-Type": "application/json" },
        body: formData
      });
      console.log("post request attempted...");


      if (!response.ok) {
        throw new Error(`Response status: ${response.status}`);
        }
      
      console.log("here is the response: "+ response);
      const result = await response.json();
      console.log(result);
    }

    catch (error) {
      console.error(error.message);
    }

  });
</script>